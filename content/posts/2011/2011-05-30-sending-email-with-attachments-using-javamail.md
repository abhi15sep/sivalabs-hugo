---
title: Sending Email with Attachments using JavaMail
author: Siva
type: post
date: 2011-05-30T08:02:00+00:00
url: /2011/05/sending-email-with-attachments-using-javamail/
blogger_blog:
  - sivalabs.blogspot.com
blogger_author:
  - Siva Prasad Reddy
blogger_permalink:
  - /2011/05/sending-email-with-attachments-using.html
blogger_internal:
  - /feeds/5739837119650074728/posts/default/5764549258380043646
post_views_count:
  - 22
categories:
  - Java
tags:
  - Java
  - JavaMail

---
We can send emails using JavaMail API.   
Instead of directly using JavaMail API here is a small utility to send emails which shields the user from JavaMail internals.

**EmailConfiguration.java**

<pre>package com.sivalabs.email;<br />import java.util.Properties;<br /><br />public class EmailConfiguration<br />{<br /> private Properties properties = new Properties();<br /> <br /> public static final String SMTP_HOST = "mail.smtp.host";<br /> public static final String SMTP_AUTH = "mail.smtp.auth";<br /> public static final String SMTP_TLS_ENABLE = "mail.smtp.starttls.enable";<br /> public static final String SMTP_AUTH_USER = "smtp.auth.user";<br /> public static final String SMTP_AUTH_PWD = "smtp.auth.pwd";<br /> public static final String DEBUG = "debug";<br /> <br /> public Properties getProperties()<br /> {<br />  return this.properties;<br /> }<br /> <br /> public void setProperty(String key, String value)<br /> {<br />  this.properties.put(key, value);<br /> }<br /> <br /> public void addProperties(Properties props)<br /> {<br />  this.properties.putAll(props);<br /> }<br /> <br /> public String getProperty(String key)<br /> {<br />  return this.properties.getProperty(key);<br /> }<br />}<br /></pre>

**Email.java**

<pre>package com.sivalabs.email;<br />import java.util.ArrayList;<br />import java.util.List;<br /><br />public class Email <br />{<br /> private String from;<br /> private String[] to;<br /> private String[] cc;<br /> private String[] bcc;<br /> private String subject;<br /> private String text;<br /> private String mimeType;<br /> private List&lt;Attachment&gt; attachments = new ArrayList&lt;Attachment&gt;();<br /> <br /> public String getFrom()<br /> {<br />  return from;<br /> }<br /> public void setFrom(String from)<br /> {<br />  this.from = from;<br /> }<br /> public String[] getTo()<br /> {<br />  return to;<br /> }<br /> public void setTo(String... to)<br /> {<br />  this.to = to;<br /> }<br /> public String[] getCc()<br /> {<br />  return cc;<br /> }<br /> public void setCc(String... cc)<br /> {<br />  this.cc = cc;<br /> }<br /> public String[] getBcc()<br /> {<br />  return bcc;<br /> }<br /> public void setBcc(String... bcc)<br /> {<br />  this.bcc = bcc;<br /> }<br /> public String getSubject()<br /> {<br />  return subject;<br /> }<br /> public void setSubject(String subject)<br /> {<br />  this.subject = subject;<br /> }<br /> public String getText()<br /> {<br />  return text;<br /> }<br /> public void setText(String text)<br /> {<br />  this.text = text;<br /> }<br /> public String getMimeType()<br /> {<br />  return mimeType;<br /> }<br /> public void setMimeType(String mimeType)<br /> {<br />  this.mimeType = mimeType;<br /> }<br /> public List&lt;Attachment&gt; getAttachments()<br /> {<br />  return attachments;<br /> }<br /> public void addAttachments(List&lt;Attachment&gt; attachments)<br /> {<br />  this.attachments.addAll(attachments);<br /> }<br /> public void addAttachment(Attachment attachment)<br /> {<br />  this.attachments.add(attachment);<br /> }<br /> public void removeAttachment(int index)<br /> {<br />  this.attachments.remove(index);<br /> }<br /> public void removeAllAttachments()<br /> {<br />  this.attachments.clear();<br /> }<br />}<br /></pre>

**Attachment.java**

<pre>package com.sivalabs.email;<br /><br />public class Attachment<br />{<br /> private byte[] data;<br /> private String filename;<br /> private String mimeType;<br /> <br /> public Attachment()<br /> {<br /> }<br /> <br /> public Attachment(byte[] data, String filename, String mimeType)<br /> {<br />  super();<br />  this.data = data;<br />  this.filename = filename;<br />  this.mimeType = mimeType;<br /> }<br /><br /> public byte[] getData()<br /> {<br />  return data;<br /> }<br /> public void setData(byte[] data)<br /> {<br />  this.data = data;<br /> }<br /> public String getFilename()<br /> {<br />  return filename;<br /> }<br /> public void setFilename(String filename)<br /> {<br />  this.filename = filename;<br /> }<br /><br /> public String getMimeType()<br /> {<br />  return mimeType;<br /> }<br /><br /> public void setMimeType(String mimeType)<br /> {<br />  this.mimeType = mimeType;<br /> }<br /> <br />}<br /></pre>

**EmailService.java**

<pre>package com.sivalabs.email;<br /><br />import java.util.List;<br /><br />import javax.activation.DataHandler;<br />import javax.activation.DataSource;<br />import javax.mail.Authenticator;<br />import javax.mail.BodyPart;<br />import javax.mail.Message;<br />import javax.mail.MessagingException;<br />import javax.mail.Multipart;<br />import javax.mail.PasswordAuthentication;<br />import javax.mail.Session;<br />import javax.mail.Transport;<br />import javax.mail.internet.AddressException;<br />import javax.mail.internet.InternetAddress;<br />import javax.mail.internet.MimeBodyPart;<br />import javax.mail.internet.MimeMessage;<br />import javax.mail.internet.MimeMultipart;<br />import javax.mail.util.ByteArrayDataSource;<br /><br />public class EmailService <br />{<br /> private EmailConfiguration configuration = null;<br /> private Authenticator auth =null;<br /> <br /> public EmailService(EmailConfiguration configuration)<br /> {<br />  this.configuration = configuration;<br />  this.auth = this.buildSmtpAuthenticator();     <br /> }<br /> <br /> private Authenticator buildSmtpAuthenticator()<br /> {<br />  String emailId = configuration.getProperty(EmailConfiguration.SMTP_AUTH_USER);<br />  String password = configuration.getProperty(EmailConfiguration.SMTP_AUTH_PWD);<br />  return new SMTPAuthenticator(emailId, password);<br /> }<br /> <br /> public void sendEmail(Email email)<br /> {<br />  Session session = Session.getDefaultInstance(this.configuration.getProperties(), auth);<br />  boolean debug = Boolean.valueOf(this.configuration.getProperty(EmailConfiguration.DEBUG));<br />     session.setDebug(debug);<br />     <br />     try <br />     {<br />      Message msg = this.buildEmailMessage(session, email);<br />   Transport.send(msg);<br />  } <br />     catch (MessagingException e) <br />  {<br />   throw new RuntimeException(e);<br />  }     <br /> }<br /> <br /> private Message buildEmailMessage(Session session, Email email) throws MessagingException<br /> {<br />  Message msg = new MimeMessage(session);<br />     msg.setSubject(email.getSubject());<br />     this.addRecievers(msg, email);<br />     Multipart multipart = new MimeMultipart();<br />     this.addMessageBodyPart(multipart, email);<br />     this.addAttachments(multipart, email);   <br />        msg.setContent(multipart);<br />     return msg;<br /> }<br /> <br /> private void addRecievers(Message msg, Email email) throws MessagingException<br /> {<br />  InternetAddress from = new InternetAddress(email.getFrom());<br />     msg.setFrom(from);<br />     <br />     InternetAddress[] to = this.getInternetAddresses(email.getTo());<br />     msg.setRecipients(Message.RecipientType.TO, to);<br /><br />     InternetAddress[] cc = this.getInternetAddresses(email.getCc());<br />     msg.setRecipients(Message.RecipientType.CC, cc);<br /><br />     InternetAddress[] bcc = this.getInternetAddresses(email.getBcc());<br />     msg.setRecipients(Message.RecipientType.BCC, bcc);<br /><br /> }<br /> private void addMessageBodyPart(Multipart multipart, Email email) throws MessagingException<br /> {<br />   BodyPart messageBodyPart = new MimeBodyPart();<br />   messageBodyPart.setContent(email.getText(), email.getMimeType());      <br />   multipart.addBodyPart(messageBodyPart);      <br /> }<br /> private void addAttachments(Multipart multipart, Email email) throws MessagingException<br /> {<br />  List&lt;Attachment&gt; attachments = email.getAttachments();<br />     if(attachments != null && attachments.size() > 0)<br />     {<br />      for (Attachment attachment : attachments) <br />      {<br />       BodyPart attachmentBodyPart = new MimeBodyPart();<br />          String filename = attachment.getFilename() ;<br />          DataSource source = new ByteArrayDataSource(attachment.getData(), <br />                 attachment.getMimeType());<br />          attachmentBodyPart.setDataHandler(new DataHandler(source));<br />          attachmentBodyPart.setFileName(filename);<br />          multipart.addBodyPart(attachmentBodyPart);<br />   }<br />     }  <br /> }<br /> private InternetAddress[] getInternetAddresses(String... addresses) <br />       throws AddressException<br /> {<br />  if(addresses == null || addresses.length == 0)<br />  {<br />   return null;<br />  }<br />  InternetAddress[] iAddresses = new InternetAddress[addresses.length];<br />     for (int i = 0; i &lt; addresses.length; i++)<br />     {<br />      iAddresses[i] = new InternetAddress(addresses[i]);<br />     }<br />     return iAddresses;<br /> }<br />}<br /><br />class SMTPAuthenticator extends javax.mail.Authenticator<br />{<br /> private String username;<br /> private String password;<br /> <br />    public SMTPAuthenticator(String username, String password) {<br />  this.username = username;<br />  this.password = password;<br /> }<br />    <br /> public PasswordAuthentication getPasswordAuthentication()<br />    {<br />        return new PasswordAuthentication(username, password);<br />    }<br />}<br /></pre>

Add the mail.jar, activation.jar to the classpath. Here is the TestClient on how to use the EmailService Utility. 

<pre>package com.sivalabs.email;<br /><br />public class EmailClient<br />{<br /> public static void main(String[] args)<br /> {<br />  EmailConfiguration configuration = new EmailConfiguration();<br />  configuration.setProperty(EmailConfiguration.SMTP_HOST, "smtp.gmail.com");<br />  configuration.setProperty(EmailConfiguration.SMTP_AUTH, "true");<br />  configuration.setProperty(EmailConfiguration.SMTP_TLS_ENABLE, "true");<br />  configuration.setProperty(EmailConfiguration.SMTP_AUTH_USER, "xyz@gmail.com");<br />  configuration.setProperty(EmailConfiguration.SMTP_AUTH_PWD, "**********");<br />  <br />  EmailService emailService = new EmailService(configuration);<br />  Email email = new Email();<br />  email.setFrom("sivaprasadreddy.k@gmail.com");<br />  email.setTo("sivaprasadreddy_k@yahoo.co.in");<br />  email.setCc("sivaprasadreddy.k@gmail.com");<br />  <br />  email.setSubject("Test Mail from SivaLabs");<br />  email.setText("Hi, 

<h1>
  This is a test email from Siva Labs
</h1>");

<br />  email.setMimeType("text/html");<br />  <br />  Attachment attachment1 = new Attachment("ABCDEFGH".getBytes(), "test1.txt","text/plain");<br />  email.addAttachment(attachment1);<br />  <br />  Attachment attachment2 = new Attachment("XYZZZZZZ".getBytes(), "test2.txt","text/plain");<br />  email.addAttachment(attachment2);<br />  <br />  emailService.sendEmail(email);<br />  <br /> }<br /><br />}<br /></pre>